<!-- 
	=> 입력한 아이디, 암호를 가지고 비동기 방식으로
		서버와 통신하여 JSON형태로 받아 아이디, 암호의 존재 여부를 확인해본다.
-->
<html>
	<meta charset="UTF-8">
	<head>
		<script src="jquery-1.11.0.min.js"></script>
		<script>
			function checkLogin(){
				//----------------------------------------------
				// 입력한 이이디를 얻어 변수에 저장
				//----------------------------------------------
				var uid = $(".uid").val();
				//----------------------------------------------
				// 만약 아이디가 비어 있으면 경고하고, 비우고, 커서 들여놓고 함수중단
				//----------------------------------------------
				if (uid.split(" ").join("")==""){
					alert("아이디 입력요망");
					$(".uid").val("");
					$(".uid").focus();
					return;
				}
				//----------------------------------------------
				// 입력한 암호를 얻어 변수에 저장
				//----------------------------------------------
				var pwd = $(".pwd").val();
				//----------------------------------------------
				// 만약 암호가 비어 있으면 경고하고, 비우고, 커서 들여놓고 함수중단
				//----------------------------------------------
				if (pwd.split(" ").join("")==""){
					alert("암호 입력요망");
					$(".pwd").val("");
					$(".pwd").focus();
					return;
				}
				//----------------------------------------------
				// 아이디, 암호의 존재개수를 비동기 방식으로 json/idCnt.json 호출하여 확인
				// 원래는 서버쪽 자원을 호출하여 json이나 html 이나 xml을 얻어야하나
				// 아직 배우지 않은 관계로 로컬에 있는 json 호출로 대체한다
				//----------------------------------------------
				$.ajax({
					//----------------------------------------------
					// 서버쪽 호출 URL 주소
					//----------------------------------------------
					url : "json/idCnt.json"
					//----------------------------------------------
					// form 태그 안의 데이터를 서버로 보내는 방법 지정 설정
					//----------------------------------------------
					,type : "post"
					//----------------------------------------------
					// 서버에 보낼 데이터를 설정
					//----------------------------------------------
					,data : "uid=" + uid + "&pwd=" + pwd
					//,data : {"uid":uid, "pwd":pwd} //JSON 표현방법
					//,data:$("[name=loginForm]").serialize();
					//,data:$("form").filter("[name=loginForm]").serialize();
					//----------------------------------------------
					// 서버가 응답할 페이지 종류, html일 경우 생략 가능
					//----------------------------------------------
					,dataType : "json"
					//----------------------------------------------
					// 서버가 응답을 성공적으로 보냈을 경우 실행할 익명함수 설정
					// 익명함수의 매개변수에는 서버의 응답물이 저장된 JSON 객체가 들어옴.
					//----------------------------------------------
					,success : function(jsonObj){
						// 매개변수로 들어오는 JSON 객체에서 아이디, 암호 존재 개수를 꺼내어
						//idCnt에 저장
						var idCnt = jsonObj.idCnt;
						// 아이디, 암호 존재 개수가 1이면 성공 메시지 출력하고 메인화면으로 이동
						if ( idCnt==1 ){
							alert("로그인성공");
							location.replace("html/main.html");
						}
						// 아이디, 암호 존재 개수 문자열이 1이아니면 경고하고 아이디. 암호비우기
						else{
							alert("로그인 실패");
							$(".uid").val("");
							$(".pwd").val("");
							$(".uid").focus();
						}
					}
					//--------------------------------
					// 서버와 통신이 실패했을경우 실행할 익명함수 설정
					//--------------------------------
					,error : function(){
						alert("에러발생");
					}
				});
			}
		</script>
	</head>
	
	<body><center>
		<form name="loginForm" action="">
			[회원가입]
			<table border="1" cellpadding="5">
			<tr>
				<td>아이디
				<td><input type="text" class="uid" name="uid">
			<tr>
				<td>암호
				<td><input type="password" class="pwd" name="pwd">
			</table><br>
			<input type="button" value="로그인" onClick="checkLogin();">
		</form>
	</body>
</html>